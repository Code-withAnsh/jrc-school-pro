<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Portal | JRC ‡§∏‡•ç‡§ï‡•Ç‡§≤</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');

    :root {
      --primary: #3b82f6;
      --glass: rgba(255, 255, 255, 0.98);
      --text-main: #1e293b;
    }

    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      background-color: #020617;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      color: var(--text-main);
    }

    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: radial-gradient(circle at center, #1e3a8a 0%, #020617 100%);
    }

    .glass-nav {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-section {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
      border-radius: 1.5rem;
      color: #1e293b;
    }

    .input-style {
      background: #f1f5f9;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      color: #1e293b;
      transition: all 0.2s ease;
      font-weight: 600;
    }

    .input-style:focus {
      border-color: var(--primary);
      background: white;
      outline: none;
    }

    .btn-action {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 0.75rem;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-action:hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }

    .result-table input {
      width: 100%;
      background: transparent;
      border-bottom: 1px solid #e2e8f0;
      padding: 4px;
      font-size: 0.875rem;
      color: #1e293b;
    }

    /* Table Alignment Fixes */
    .roster-table th, .roster-table td {
      padding: 1.25rem 1rem;
      vertical-align: middle;
      text-align: left;
    }
    
    /* ALIGNMENT CORRECTION: Target the last column specifically */
    .roster-table th:last-child, 
    .roster-table td:last-child {
      text-align: right !important;
      padding-right: 1.5rem !important;
    }

    /* Container for buttons within the action cell to prevent breaking lines */
    .action-btn-group {
      display: inline-flex;
      gap: 0.5rem;
      justify-content: flex-end;
      width: 100%;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
  </style>
</head>
<body>

  <div id="canvas-container"></div>

  <!-- HEADER -->
  <header class="glass-nav text-white sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center space-x-3">
        <div class="bg-blue-600 text-white font-black rounded-xl h-10 w-10 flex items-center justify-center text-lg border border-blue-400">T</div>
        <div>
          <h1 class="text-lg font-extrabold tracking-tight" id="navTitle">JRC ‡§ü‡•Ä‡§ö‡§∞ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</h1>
          <p class="text-blue-300 text-[10px] font-bold uppercase tracking-wider" id="navSub">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®, ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§µ ‡§´‡•Ä‡§∏</p>
        </div>
      </div>
      
      <div class="flex flex-wrap items-center gap-3">
        <button id="langToggle" class="bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-lg text-xs font-bold border border-white/20">
          üåê <span id="langText">English</span>
        </button>
        <span class="text-xs font-bold bg-blue-900/50 px-3 py-1.5 rounded-lg border border-blue-700" id="teacherName">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, ‡§ü‡•Ä‡§ö‡§∞</span>
        <button id="refreshBtn" class="btn-action bg-blue-600 px-3 py-1.5 text-xs text-white">üîÑ <span id="txtRefresh">‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂</span></button>
        <button id="logoutBtn" class="btn-action bg-red-500 px-3 py-1.5 text-xs text-white">üö™ <span id="txtLogout">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</span></button>
        <a href="school.html" class="btn-action bg-white text-blue-900 px-3 py-1.5 text-xs">üè† <span id="txtHome">‡§π‡•ã‡§Æ</span></a>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8 space-y-8">
    
    <!-- 1. REGISTRATION -->
    <section class="glass-section p-8 animate__animated animate__fadeInUp">
      <div class="flex items-center gap-3 mb-4">
        <div class="p-3 bg-blue-100 text-blue-700 rounded-xl">üìù</div>
        <h2 class="text-2xl font-black" id="h2Reg">‡§õ‡§æ‡§§‡•ç‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
      </div>
      <p class="text-sm text-gray-500 mb-6 font-medium" id="pRegHint">‡§Ü‡§™ ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§™‡§®‡•Ä ‡§ï‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§π‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
      
      <form id="registerStudentForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
        <div>
          <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblRegName">‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
          <input type="text" id="regName" required class="w-full input-style px-4 py-2.5" placeholder="‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
        </div>
        <div>
          <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblRegClass">‡§ï‡§ï‡•ç‡§∑‡§æ</label>
          <select id="regClass" required class="w-full input-style px-4 py-2.5 appearance-none">
            <option value="">-- ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
            <option value="Nursery">Nursery</option><option value="LKG">LKG</option><option value="UKG">UKG</option>
            <option value="1">1</option><option value="2">2</option><option value="3">3</option>
            <option value="4">4</option><option value="5">5</option><option value="6">6</option>
            <option value="9-Science">9 (Science)</option><option value="11-Arts">11 (Arts)</option>
          </select>
        </div>
        <div>
          <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblRegRoll">‡§∞‡•ã‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
          <input type="text" id="regRollNo" required class="w-full input-style px-4 py-2.5" placeholder="‡§∞‡•ã‡§≤">
        </div>
        <button type="submit" class="btn-action bg-blue-600 text-white py-3 shadow-lg" id="btnReg">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
      </form>
    </section>

    <!-- 2. ROSTER LIST -->
    <section class="glass-section p-8 animate__animated animate__fadeInUp">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-black" id="h2List">‡§õ‡§æ‡§§‡•ç‡§∞ ‡§∏‡•Ç‡§ö‡•Ä</h2>
        <select id="classFilter" class="input-style px-3 py-1 text-xs">
          <option value="">‡§∏‡§≠‡•Ä ‡§ï‡§ï‡•ç‡§∑‡§æ‡§è‡§Ç</option>
        </select>
      </div>
      <div class="overflow-x-auto rounded-xl border border-gray-100 bg-white">
        <table class="min-w-full text-sm roster-table border-collapse">
          <thead class="bg-gray-50 border-b">
            <tr class="text-gray-400 font-black uppercase text-[10px] tracking-widest">
              <th id="thName">‡§®‡§æ‡§Æ</th>
              <th id="thClass">‡§ï‡§ï‡•ç‡§∑‡§æ</th>
              <th id="thRoll">‡§∞‡•ã‡§≤</th>
              <th id="thAccount">‡§ñ‡§æ‡§§‡§æ</th>
              <th id="thAction">‡§ï‡§æ‡§∞‡•ç‡§Ø</th>
            </tr>
          </thead>
          <tbody id="studentsTableBody" class="divide-y divide-gray-100 font-bold">
            <!-- Data will be loaded by js/teacher.js -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- 3. SELECTED STUDENT: RESULT & FEES -->
    <section id="selectedStudentSection" class="hidden animate__animated animate__fadeIn">
      <div class="bg-blue-600 text-white p-6 rounded-t-3xl flex items-center justify-between">
        <h2 class="text-xl font-black flex items-center gap-2">
          <span class="bg-white/20 p-2 rounded-lg">üìã</span>
          <span id="selectedStudentTitle">‡§Æ‡•à‡§®‡•á‡§ú ‡§∏‡•ç‡§ü‡•Ç‡§°‡•á‡§Ç‡§ü</span>
        </h2>
        <button onclick="document.getElementById('selectedStudentSection').classList.add('hidden')" class="bg-white/10 hover:bg-white/20 px-4 py-1.5 rounded-xl font-black text-xs">‚úï ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
      </div>

      <div class="grid md:grid-cols-2 gap-px bg-gray-200 rounded-b-3xl overflow-hidden shadow-2xl">
        
        <!-- RESULT SECTION -->
        <div class="bg-white p-8">
          <h3 class="text-lg font-black text-gray-800 mb-6" id="h3Res">üìä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
          <form id="addResultForm" class="space-y-4">
            <input type="hidden" id="resultStudentId">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblExam">‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                <input type="text" id="resultExamName" required class="w-full input-style px-4 py-2 text-sm" placeholder="‡§Ö‡§∞‡•ç‡§ß‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï 2024">
              </div>
              <div>
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblSession">‡§∏‡§§‡•ç‡§∞</label>
                <input type="text" id="resultSession" required class="w-full input-style px-4 py-2 text-sm" value="2024-25">
              </div>
            </div>

            <div class="border rounded-2xl p-4 bg-gray-50">
              <table class="min-w-full result-table">
                <thead>
                  <tr class="text-[10px] font-black text-gray-400 uppercase tracking-wider">
                    <th class="text-left pb-2" id="thSub">‡§µ‡§ø‡§∑‡§Ø</th>
                    <th class="text-left pb-2" id="thTotal">‡§ï‡•Å‡§≤</th>
                    <th class="text-left pb-2" id="thObt">‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="subjectsTableBody"></tbody>
              </table>
              <button type="button" id="addSubjectBtn" class="mt-3 w-full py-2 border-2 border-dashed border-gray-300 rounded-xl text-[10px] font-black text-gray-400 hover:text-blue-600 hover:border-blue-600 transition-colors uppercase" id="btnAddSub">+ ‡§®‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblGrandTotal">‡§ï‡•Å‡§≤ ‡§Ö‡§Ç‡§ï</label>
                <input type="number" id="resultTotalMarks" class="w-full input-style px-4 py-2 bg-gray-100" readonly>
              </div>
              <div>
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblGrandObt">‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§</label>
                <input type="number" id="resultObtainedMarks" class="w-full input-style px-4 py-2 bg-gray-100" readonly>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-3">
              <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-center">
                <p class="text-[9px] font-black text-blue-400 uppercase" id="lblPercent">‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§</p>
                <span id="autoPercentage" class="text-blue-700 font-black text-lg">0%</span>
              </div>
              <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-center">
                <p class="text-[9px] font-black text-blue-400 uppercase" id="lblGrade">‡§ó‡•ç‡§∞‡•á‡§°</p>
                <span id="autoGrade" class="text-blue-700 font-black text-lg">-</span>
              </div>
              <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-center">
                <p class="text-[9px] font-black text-blue-400 uppercase" id="lblStatus">‡§∏‡•ç‡§•‡§ø‡§§‡§ø</p>
                <span id="autoPassFail" class="text-blue-700 font-black text-lg">-</span>
              </div>
            </div>

            <button type="submit" class="w-full btn-action bg-blue-600 text-white py-4 shadow-lg" id="btnSaveRes">‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
          </form>
          <div id="studentResultsList" class="mt-6 space-y-2"></div>
        </div>

        <!-- FEE SECTION -->
        <div class="bg-gray-50 p-8 border-l border-gray-100">
          <h3 class="text-lg font-black text-gray-800 mb-6" id="h3Fee">üí∞ ‡§´‡•Ä‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</h3>
          <form id="addFeeForm" class="space-y-4">
            <input type="hidden" id="feeStudentId">
            <div>
              <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblMonth">‡§Æ‡§π‡•Ä‡§®‡§æ</label>
              <select id="feeMonth" class="w-full input-style px-4 py-2 text-sm">
                <option value="April">April</option><option value="May">May</option>
                <option value="June">June</option><option value="July">July</option>
                <option value="August">August</option><option value="September">September</option>
                <option value="October">October</option><option value="November">November</option>
                <option value="December">December</option><option value="January">January</option>
                <option value="February">February</option><option value="March">March</option>
              </select>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblTotalFee">‡§ï‡•Å‡§≤ ‡§´‡•Ä‡§∏ (‚Çπ)</label>
                <input type="number" id="feeAmount" required class="w-full input-style px-4 py-2 text-sm">
              </div>
              <div>
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1" id="lblPaidFee">‡§ú‡§Æ‡§æ ‡§ï‡•Ä ‡§ó‡§à (‚Çπ)</label>
                <input type="number" id="feePaid" required class="w-full input-style px-4 py-2 text-sm" value="0">
              </div>
            </div>
            <button type="submit" class="w-full btn-action bg-green-600 text-white py-4 shadow-lg" id="btnSaveFee">‡§´‡•Ä‡§∏ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
          </form>
          <div id="studentFeesList" class="mt-6 space-y-2"></div>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- Keep your real database scripts -->
  <script src="js/teacher-auth.js"></script>
  <script src="js/teacher.js"></script>

  <script>
    let currentLang = 'hi';
    const translations = {
      en: {
        navTitle: "JRC Teacher Portal", navSub: "Registration, Results & Fees",
        h2Reg: "Student Registration", pRegHint: "You can only register students for your own class.",
        lblRegName: "Student Name", lblRegClass: "Class", lblRegRoll: "Roll No", btnReg: "Register Student",
        h2List: "Class Roster", thName: "Name", thClass: "Class", thRoll: "Roll", 
        thAccount: "Account", thAction: "Actions", 
        h3Res: "üìä Add Examination Result", h3Fee: "üí∞ Fee Management",
        lblExam: "Exam Name", lblSession: "Session", thSub: "Subject", thTotal: "Total", thObt: "Obtained",
        lblGrandTotal: "Grand Total", lblGrandObt: "Total Obtained", lblPercent: "Percent", lblGrade: "Grade", lblStatus: "Status",
        btnSaveRes: "Save Result", btnSaveFee: "Update Fee Record", lang: "English", txtRefresh: "Refresh", txtLogout: "Logout", txtHome: "Home",
        btnAddSub: "+ Add Subject Field"
      },
      hi: {
        navTitle: "JRC ‡§ü‡•Ä‡§ö‡§∞ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤", navSub: "‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®, ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§µ ‡§´‡•Ä‡§∏",
        h2Reg: "‡§õ‡§æ‡§§‡•ç‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®", pRegHint: "‡§Ü‡§™ ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§™‡§®‡•Ä ‡§ï‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§π‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§",
        lblRegName: "‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ", lblRegClass: "‡§ï‡§ï‡•ç‡§∑‡§æ", lblRegRoll: "‡§∞‡•ã‡§≤ ‡§®‡§Ç‡§¨‡§∞", btnReg: "‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç",
        h2List: "‡§õ‡§æ‡§§‡•ç‡§∞ ‡§∏‡•Ç‡§ö‡•Ä", thName: "‡§®‡§æ‡§Æ", thClass: "‡§ï‡§ï‡•ç‡§∑‡§æ", thRoll: "‡§∞‡•ã‡§≤", 
        thAccount: "‡§ñ‡§æ‡§§‡§æ", thAction: "‡§ï‡§æ‡§∞‡•ç‡§Ø", 
        h3Res: "üìä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç", h3Fee: "üí∞ ‡§´‡•Ä‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü",
        lblExam: "‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ", lblSession: "‡§∏‡§§‡•ç‡§∞", thSub: "‡§µ‡§ø‡§∑‡§Ø", thTotal: "‡§ï‡•Å‡§≤", thObt: "‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§",
        lblGrandTotal: "‡§ï‡•Å‡§≤ ‡§Ö‡§Ç‡§ï", lblGrandObt: "‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§", lblPercent: "‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§", lblGrade: "‡§ó‡•ç‡§∞‡•á‡§°", lblStatus: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø",
        btnSaveRes: "‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç", btnSaveFee: "‡§´‡•Ä‡§∏ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç", lang: "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä", txtRefresh: "‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂", txtLogout: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü", txtHome: "‡§π‡•ã‡§Æ",
        btnAddSub: "+ ‡§®‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç"
      }
    };

    function applyLanguage(lang) {
      const t = translations[lang];
      for (let id in t) {
        const el = document.getElementById(id);
        if (el) {
          if (['SPAN', 'H1', 'H2', 'H3', 'P', 'TH', 'BUTTON', 'LABEL'].includes(el.tagName)) {
            el.innerText = t[id];
          }
        }
      }
      document.getElementById('langText').innerText = t.lang;
    }

    document.getElementById('langToggle').onclick = () => {
      currentLang = currentLang === 'en' ? 'hi' : 'en';
      applyLanguage(currentLang);
    };

    // Result Calculation
    const subjectsTableBody = document.getElementById('subjectsTableBody');
    const addSubjectBtn = document.getElementById('addSubjectBtn');

    function createSubjectRow(sub = '', total = 100, obt = 0) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="py-2"><input type="text" value="${sub}" placeholder="Subject" class="subject-name font-bold"></td>
        <td class="py-2"><input type="number" value="${total}" class="total-marks"></td>
        <td class="py-2"><input type="number" value="${obt}" class="obt-marks"></td>
        <td class="py-2 text-right"><button type="button" class="text-red-400 font-bold px-2" onclick="this.parentElement.parentElement.remove(); calculateResults();">‚úï</button></td>
      `;
      tr.querySelectorAll('input').forEach(input => input.addEventListener('input', calculateResults));
      subjectsTableBody.appendChild(tr);
    }
  
    function calculateResults() {
      let grandTotal = 0, totalObtained = 0;
      subjectsTableBody.querySelectorAll('tr').forEach(row => {
        const t = parseFloat(row.querySelector('.total-marks').value) || 0;
        const o = parseFloat(row.querySelector('.obt-marks').value) || 0;
        grandTotal += t; totalObtained += o;
      });
      document.getElementById('resultTotalMarks').value = grandTotal;
      document.getElementById('resultObtainedMarks').value = totalObtained;
      const percent = grandTotal > 0 ? ((totalObtained / grandTotal) * 100).toFixed(1) : 0;
      document.getElementById('autoPercentage').innerText = percent + '%';
      let grade = 'F';
      if (percent >= 90) grade = 'A+';
      else if (percent >= 80) grade = 'A';
      else if (percent >= 70) grade = 'B';
      else if (percent >= 60) grade = 'C';
      else if (percent >= 33) grade = 'D';
      document.getElementById('autoGrade').innerText = grade;
      document.getElementById('autoPassFail').innerText = percent >= 33 ? 'PASS' : 'FAIL';
      document.getElementById('autoPassFail').style.color = percent >= 33 ? '#059669' : '#dc2626';
    }

    addSubjectBtn.onclick = () => createSubjectRow();

    // 3D Background
    let scene, camera, renderer, starGeo, stars;
    function init3D() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 1000);
      camera.position.z = 1; camera.rotation.x = Math.PI/2;
      renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('canvas-container').appendChild(renderer.domElement);
      starGeo = new THREE.BufferGeometry();
      const pos = new Float32Array(6000 * 3);
      for(let i=0; i<18000; i++) pos[i] = (Math.random() - 0.5) * 800;
      starGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
      stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color:0xffffff, size:0.7, transparent:true, opacity:0.8}));
      scene.add(stars);
      function animate() {
        const p = starGeo.attributes.position.array;
        for(let i=1; i<p.length; i+=3) { p[i] -= 0.6; if(p[i] < -400) p[i] = 400; }
        starGeo.attributes.position.needsUpdate = true;
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      animate();
    }

    window.onload = () => {
      init3D();
      applyLanguage(currentLang);
      ['Maths', 'Science', 'English', 'Hindi'].forEach(s => createSubjectRow(s));
      calculateResults();
    }

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>